<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diet Explorer</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Theme Variables */
    :root {
      --primary-color: #3498db;
      --secondary-color: #2980b9;
      --background-color: #f0f4f8;
      --text-color: #2c3e50;
      --container-bg: white;
      --border-color: #e0e0e0;
      --success-color: #2ecc71;
      --warning-color: #f1c40f;
      --danger-color: #e74c3c;
    }

    /* Dark Theme */
    [data-theme="dark"] {
      --primary-color: #2980b9;
      --secondary-color: #1abc9c;
      --background-color: #1a1a1a;
      --text-color: #ffffff;
      --container-bg: #2d2d2d;
      --hover-color: #3d3d3d;
      --border-color: #404040;
    }

    /* High Contrast Theme */
    [data-theme="high-contrast"] {
      --primary-color: #000000;
      --secondary-color: #ffffff;
      --background-color: #ffffff;
      --text-color: #000000;
      --container-bg: #ffffff;
      --hover-color: #f0f0f0;
      --border-color: #000000;
    }

    /* Nature Theme */
    [data-theme="nature"] {
      --primary-color: #4CAF50;
      --secondary-color: #8BC34A;
      --background-color: #E8F5E9;
      --text-color: #1B5E20;
      --container-bg: #FFFFFF;
      --hover-color: #C8E6C9;
      --border-color: #81C784;
    }

    /* Ocean Theme */
    [data-theme="ocean"] {
      --primary-color: #0288D1;
      --secondary-color: #03A9F4;
      --background-color: #E1F5FE;
      --text-color: #01579B;
      --container-bg: #FFFFFF;
      --hover-color: #B3E5FC;
      --border-color: #4FC3F7;
    }

    /* Sunset Theme */
    [data-theme="sunset"] {
      --primary-color: #FF5722;
      --secondary-color: #FF9800;
      --background-color: #FBE9E7;
      --text-color: #BF360C;
      --container-bg: #FFFFFF;
      --hover-color: #FFCCBC;
      --border-color: #FF8A65;
    }

    /* Purple Dream Theme */
    [data-theme="purple-dream"] {
      --primary-color: #9C27B0;
      --secondary-color: #BA68C8;
      --background-color: #F3E5F5;
      --text-color: #4A148C;
      --container-bg: #FFFFFF;
      --hover-color: #E1BEE7;
      --border-color: #CE93D8;
    }

    /* Autumn Theme */
    [data-theme="autumn"] {
      --primary-color: #795548;
      --secondary-color: #A1887F;
      --background-color: #EFEBE9;
      --text-color: #3E2723;
      --container-bg: #FFFFFF;
      --hover-color: #D7CCC8;
      --border-color: #BCAAA4;
    }

    /* Spring Theme */
    [data-theme="spring"] {
      --primary-color: #8BC34A;
      --secondary-color: #AED581;
      --background-color: #F1F8E9;
      --text-color: #33691E;
      --container-bg: #FFFFFF;
      --hover-color: #DCEDC8;
      --border-color: #9CCC65;
    }

    /* Summer Theme */
    [data-theme="summer"] {
      --primary-color: #FDD835;
      --secondary-color: #FFE57F;
      --background-color: #FFFDE7;
      --text-color: #F57F17;
      --container-bg: #FFFFFF;
      --hover-color: #FFF9C4;
      --border-color: #FFE082;
    }

    /* Winter Theme */
    [data-theme="winter"] {
      --primary-color: #90CAF9;
      --secondary-color: #64B5F6;
      --background-color: #E3F2FD;
      --text-color: #1565C0;
      --container-bg: #FFFFFF;
      --hover-color: #BBDEFB;
      --border-color: #42A5F5;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--background-color);
      color: var(--text-color);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .main-nav {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      overflow-x: auto;
      padding: 10px 0;
      background-color: var(--container-bg);
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .nav-button {
      padding: 15px 25px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: background-color 0.3s;
      white-space: nowrap;
      font-size: 1.1em;
    }

    .nav-button:hover, .nav-button.active {
      background-color: var(--secondary-color);
    }

    .section {
      background-color: var(--container-bg);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: none;
    }

    .section.active {
      display: block;
    }

    /* Diet Manager Styles */
    .diet-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      overflow-x: auto;
      padding: 10px 0;
    }

    .tab {
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: background-color 0.3s;
      white-space: nowrap;
    }

    .tab:hover, .tab.active {
      background-color: var(--secondary-color);
    }

    .diet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .diet-card {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .diet-card h3 {
      margin-top: 0;
      color: var(--primary-color);
    }

    .condition-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin: 10px 0;
    }

    .tag {
      padding: 4px 8px;
      border-radius: 15px;
      font-size: 0.8em;
      background-color: var(--primary-color);
      color: white;
    }

    .macro-chart {
      height: 20px;
      background-color: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
      display: flex;
    }

    .macro-segment {
      height: 100%;
      transition: width 0.3s;
    }

    .protein { background-color: var(--primary-color); }
    .carbs { background-color: var(--warning-color); }
    .fats { background-color: var(--danger-color); }

    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-group {
      flex: 1;
      min-width: 200px;
    }

    .menu-builder {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .food-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .food-item-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    input, select {
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      margin-bottom: 10px;
    }

    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background-color: var(--primary-color);
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: var(--secondary-color);
    }

    .summary-card {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      position: sticky;
      top: 20px;
    }

    .macro-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    /* Unit Converter Styles */
    .unit-section {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    .unit-converter {
      flex: 1;
      min-width: 300px;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .unit-group {
      margin-bottom: 15px;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
      text-align: center;
    }

    .result h3 {
      margin: 0;
      color: var(--primary-color);
    }

    @media (max-width: 768px) {
      .menu-builder {
        grid-template-columns: 1fr;
      }
      
      .unit-converter {
        min-width: 100%;
      }
    }

    .settings-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-left: auto;
      padding: 0 15px;
    }

    .settings-controls select {
      padding: 8px;
      border-radius: 20px;
      border: 1px solid var(--border-color);
      background-color: var(--container-bg);
      color: var(--text-color);
      cursor: pointer;
      margin: 0;
    }

    [dir="rtl"] {
      direction: rtl;
      text-align: right;
    }

    [dir="rtl"] .settings-controls {
      margin-right: auto;
      margin-left: 0;
    }

    /* Enhanced RTL support */
    [dir="rtl"] .diet-card {
      text-align: right;
    }

    [dir="rtl"] .food-item-controls {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .macro-label {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .condition-tags {
      justify-content: flex-end;
    }

    /* Food Item Addition Styles */
    .food-search-section {
      background-color: var(--container-bg);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .food-search-controls {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 15px;
      margin-bottom: 20px;
    }

    .food-search-controls input,
    .food-search-controls select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
    }

    .food-search-controls button {
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
    }

    .food-results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }

    .food-item-card {
      background-color: var(--container-bg);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .food-category-label {
      background-color: var(--primary-color);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
    }

    .nutrition-main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .meal-selection {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .meal-type-select {
      flex: 1;
    }

    .meal-group {
      background-color: var(--container-bg);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .meal-group h4 {
      color: var(--primary-color);
      margin-bottom: 10px;
    }

    .meal-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .food-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background-color: var(--hover-color);
      border-radius: 6px;
    }

    .food-item-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .calories-info {
      color: var(--primary-color);
      font-weight: 500;
    }

    .food-item-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .food-item-controls input {
      width: 80px;
      padding: 4px 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }

    .nutrition-summary {
      position: sticky;
      top: 20px;
    }

    .summary-card {
      background-color: var(--container-bg);
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .macro-chart {
      height: 20px;
      background-color: var(--hover-color);
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
      display: flex;
    }

    .macro-segment {
      height: 100%;
      transition: width 0.3s ease;
    }

    .protein { background-color: var(--primary-color); }
    .carbs { background-color: var(--warning-color); }
    .fats { background-color: var(--danger-color); }

    .macro-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .meal-division {
      margin-top: 20px;
    }

    .meal-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: var(--hover-color);
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .meal-item span:first-child {
      color: var(--text-color);
    }

    .meal-item span:last-child {
      font-weight: 600;
      color: var(--primary-color);
    }

    .no-results {
      text-align: center;
      padding: 20px;
      color: var(--text-color);
      grid-column: 1 / -1;
    }

    .food-category-group {
      margin-bottom: 20px;
      padding: 10px;
      background-color: var(--container-bg);
      border-radius: 8px;
    }

    .food-category-group h4 {
      margin: 0 0 10px 0;
      color: var(--primary-color);
    }

    .nutrition-detailed {
      margin-top: 10px;
      padding: 10px;
      background-color: var(--hover-color);
      border-radius: 4px;
    }

    .nutrients-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 5px;
      font-size: 0.9em;
    }

    .serving-sizes {
      margin-top: 10px;
    }

    .quick-add-btn {
      padding: 4px 8px;
      margin: 2px;
      font-size: 0.9em;
      background-color: var(--secondary-color);
    }

    .tts-button {
      padding: 4px;
      background: none;
      border: none;
      color: var(--primary-color);
      cursor: pointer;
    }

    .tts-button:hover {
      color: var(--secondary-color);
    }

    .portion-size {
      font-size: 0.9em;
      color: var(--text-color);
      opacity: 0.8;
    }

    .nutrients-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      font-size: 0.9em;
      margin-top: 8px;
    }

    .serving-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 8px;
    }

    .diet-tags, .method-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .diet-tag, .method-tag {
      padding: 2px 6px;
      border-radius: 12px;
      font-size: 0.8em;
      background-color: var(--hover-color);
      color: var(--text-color);
    }

    .allergen-warning {
      cursor: help;
      margin-left: 8px;
    }

    .card-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .voice-control-btn {
      padding: 8px;
      border-radius: 50%;
      background: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .voice-control-btn.active {
      background: var(--danger-color);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .dietary-filters {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }

    .dietary-filter-group {
      background: var(--container-bg);
      padding: 10px;
      border-radius: 8px;
    }

    .dietary-filter-group h4 {
      margin: 0 0 10px 0;
      color: var(--primary-color);
    }

    .dietary-tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    .dietary-tag-checkbox {
      display: none;
    }

    .dietary-tag-label {
      padding: 4px 8px;
      border-radius: 15px;
      font-size: 0.8em;
      background: var(--hover-color);
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .dietary-tag-checkbox:checked + .dietary-tag-label {
      background: var(--primary-color);
      color: white;
    }

    /* Add responsive design improvements */
    /* Base responsive container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
    }

    /* Responsive navigation */
    .main-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px;
      position: sticky;
      top: 0;
      z-index: 1000;
      background-color: var(--container-bg);
    }

    .nav-button {
      flex: 1 1 auto;
      min-width: 120px;
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: 12px 16px;
      font-size: clamp(0.875rem, 2vw, 1.1rem);
    }

    /* Settings controls responsive layout */
    .settings-controls {
      display: flex;
      gap: 8px;
      margin: 8px 0;
      flex-wrap: wrap;
      width: 100%;
    }

    .settings-controls select {
      flex: 1;
      min-width: 120px;
      max-width: 200px;
      font-size: clamp(0.875rem, 2vw, 1rem);
    }

    /* Responsive grid layouts */
    .diet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      padding: 10px;
    }

    .food-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      max-height: 60vh;
      overflow-y: auto;
      padding: 8px;
    }

    /* Responsive menu builder */
    .menu-builder {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    @media (min-width: 768px) {
      .menu-builder {
        grid-template-columns: 2fr 1fr;
      }
    }

    /* Food card responsive design */
    .food-item-card {
      display: flex;
      flex-direction: column;
      height: auto;
      min-height: 120px;
    }

    .food-item-details {
      display: grid;
      gap: 8px;
    }

    .nutrition-main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 4px;
    }

    /* Responsive unit converter */
    .unit-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
    }

    .unit-converter {
      width: 100%;
    }

    .unit-group {
      display: grid;
      gap: 8px;
    }

    /* Responsive form elements */
    input, select, button {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      font-size: clamp(0.875rem, 2vw, 1rem);
    }

    /* Food search controls responsive */
    .food-search-controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media (min-width: 640px) {
      .food-search-controls {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (min-width: 960px) {
      .food-search-controls {
        grid-template-columns: 1fr 1fr auto;
      }
    }

    /* Dietary filters responsive */
    .dietary-filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
    }

    .dietary-tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    /* Summary card responsive */
    .summary-card {
      position: sticky;
      top: 20px;
      background: var(--container-bg);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    /* Touch-friendly improvements */
    @media (hover: none) {
      .food-item-card,
      .nav-button,
      .dietary-tag-label,
      button {
      cursor: pointer;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }

      .food-item-card:active,
      .nav-button:active,
      .dietary-tag-label:active,
      button:active {
        transform: scale(0.98);
      }
    }

    /* Small screen optimizations */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .nav-button {
        padding: 10px;
        font-size: 0.9rem;
        min-width: 100px;
      }

      .food-item-card {
        padding: 12px;
      }

      .macro-chart {
        height: 16px;
      }

      .serving-buttons {
        flex-direction: column;
      }

      .quick-add-btn {
        width: 100%;
        margin: 2px 0;
      }
    }

    /* Improved scrollbars */
    .food-results::-webkit-scrollbar {
      width: 8px;
    }

    .food-results::-webkit-scrollbar-track {
      background: var(--background-color);
      border-radius: 4px;
    }

    .food-results::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }

    /* Loading states */
    .loading {
      opacity: 0.7;
      pointer-events: none;
      position: relative;
    }

    .loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 24px;
      height: 24px;
      margin: -12px;
      border: 2px solid var(--primary-color);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Improved focus states */
    :focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    /* Touch-friendly buttons */
    button, 
    .nav-button,
    .quick-add-btn {
      min-height: 44px;
    }

    /* Improved spacing for touch targets */
    .food-item-controls {
      gap: 12px;
    }

    .food-item-controls input {
      min-width: 80px;
    }

    /* Font size adjustments */
    html {
      font-size: clamp(14px, 2.5vw, 16px);
    }

    h1 { font-size: clamp(1.5rem, 4vw, 2rem); }
    h2 { font-size: clamp(1.25rem, 3vw, 1.75rem); }
    h3 { font-size: clamp(1.1rem, 2.5vw, 1.5rem); }
    h4 { font-size: clamp(1rem, 2vw, 1.25rem); }

    /* Improved contrast and readability */
    .food-category-label,
    .diet-tag,
    .method-tag {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
    }

    /* Responsive macro chart */
    .macro-chart {
      height: clamp(16px, 3vw, 20px);
    }

    /* Better touch area for checkboxes */
    .dietary-tag-label {
      padding: 8px 12px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Add styles for meal division */
    .meal-division {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }

    .meal-division h4 {
      margin: 0 0 10px 0;
      color: var(--primary-color);
      font-size: 1rem;
    }

    .meal-breakdown {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .meal-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: var(--hover-color);
      border-radius: 6px;
      font-size: 0.9rem;
    }

    .meal-item span:first-child {
      color: var(--text-color);
    }

    .meal-item span:last-child {
      font-weight: 600;
      color: var(--primary-color);
    }

    /* Add styles for the meal selection and display */
    .meal-selection {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .meal-type-select {
      flex: 1;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
    }

    .meal-group {
      margin-bottom: 20px;
      padding: 15px;
      background-color: var(--container-bg);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .meal-group h4 {
      margin: 0 0 10px 0;
      color: var(--primary-color);
    }

    .meal-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .calories-info {
      color: var(--primary-color);
      font-weight: 500;
      margin-left: 10px;
    }

    .food-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background-color: var(--hover-color);
      border-radius: 6px;
    }

    .food-item-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .food-item-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .food-item-controls input {
      width: 80px;
      padding: 4px 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="main-nav">
      <button class="nav-button active" onclick="showMainSection('hospital')">Hospital Diets</button>
      <button class="nav-button" onclick="showMainSection('popular')">Popular Diets</button>
      <button class="nav-button" onclick="showMainSection('custom')">Custom Menu</button>
      <button class="nav-button" onclick="showMainSection('units')">Unit Converter</button>
      <div class="settings-controls">
        <select id="theme-select" onchange="changeTheme(this.value)">
          <option value="light">Light Theme</option>
          <option value="dark">Dark Theme</option>
          <option value="high-contrast">High Contrast</option>
          <option value="nature">Nature Theme</option>
          <option value="ocean">Ocean Theme</option>
          <option value="sunset">Sunset Theme</option>
          <option value="purple-dream">Purple Dream</option>
          <option value="autumn">Autumn</option>
          <option value="spring">Spring</option>
          <option value="summer">Summer</option>
          <option value="winter">Winter</option>
        </select>
        <select id="language-select" onchange="changeLanguage(this.value)">
          <option value="en">English</option>
          <option value="es">Español</option>
          <option value="fr">Français</option>
          <option value="de">Deutsch</option>
          <option value="zh">中文</option>
          <option value="ar">العربية</option>
          <option value="ko">한국어</option>
          <option value="ja">日本語</option>
          <option value="it">Italiano</option>
          <option value="pt">Português</option>
          <option value="hi">हिंदी</option>
        </select>
      </div>
    </div>

    <!-- Hospital Diets Section -->
    <div id="hospital-section" class="section active">
      <h2>Hospital Diets</h2>
      <div class="filters">
        <div class="filter-group">
          <select id="condition-filter" onchange="filterDiets()">
            <option value="">All Conditions</option>
            <option value="diabetic">Diabetic-Friendly</option>
            <option value="cardiac">Cardiac-Safe</option>
            <option value="renal">Renal-Safe</option>
            <option value="low-sodium">Low Sodium</option>
            <option value="celiac">Celiac Disease</option>
            <option value="religious">Religious Dietary Laws</option>
            <option value="bone-health">Bone Health</option>
            <option value="anemia">Anemia</option>
            <option value="inflammation">Anti-Inflammatory</option>
            <option value="digestive-health">Digestive Health</option>
            <option value="ibd">IBD/Crohn's</option>
            <option value="gastroparesis">Gastroparesis</option>
            <option value="nut-allergies">Nut Allergies</option>
            <option value="lactose-intolerance">Lactose Intolerance</option>
            <option value="gut-health">Gut Health</option>
        </select>
      </div>
        <div class="filter-group">
          <select id="consistency-filter" onchange="filterDiets()">
            <option value="">All Consistencies</option>
            <option value="regular">Regular</option>
            <option value="soft">Soft</option>
            <option value="liquid">Liquid</option>
            <option value="pureed">Pureed</option>
        </select>
      </div>
      </div>
      <div class="diet-grid" id="hospital-diets"></div>
    </div>

    <!-- Popular Diets Section -->
    <div id="popular-section" class="section">
      <h2>Popular Diets</h2>
      <div class="filters">
        <div class="filter-group">
          <select id="goal-filter" onchange="filterDiets()">
            <option value="">All Goals</option>
            <option value="weight-loss">Weight Loss</option>
            <option value="muscle-gain">Muscle Gain</option>
            <option value="maintenance">Maintenance</option>
          </select>
        </div>
      </div>
      <div class="diet-grid" id="popular-diets"></div>
    </div>

    <!-- Custom Menu Builder Section -->
    <div id="custom-section" class="section">
      <h2>Custom Menu Builder</h2>
      <div class="menu-builder">
        <div class="food-list">
          <div class="food-search-section">
            <h3>Add Food Items</h3>
            <div class="food-search-controls">
              <input type="text" id="food-search" placeholder="Search foods..." oninput="searchFoods()">
              <select id="food-category" onchange="searchFoods()">
                <option value="">All Categories</option>
                <option value="protein">Proteins</option>
                <option value="carbs">Carbohydrates</option>
                <option value="fats">Fats</option>
                <option value="vegetables">Vegetables</option>
                <option value="fruits">Fruits</option>
              </select>
            </div>
            <div id="food-results" class="food-results"></div>
          </div>
          <div id="menu-items">
            <h3>Selected Items</h3>
            <!-- Menu items will be dynamically added here -->
          </div>
        </div>
        <div class="nutrition-summary">
          <div class="summary-card">
            <h3>Nutrition Summary</h3>
            <div class="macro-chart">
              <div id="protein-bar" class="macro-segment protein" style="width: 0%"></div>
              <div id="carbs-bar" class="macro-segment carbs" style="width: 0%"></div>
              <div id="fats-bar" class="macro-segment fats" style="width: 0%"></div>
            </div>
            <div class="macro-label">
              <span>Protein: <span id="protein-value">0g</span></span>
              <span>Carbs: <span id="carbs-value">0g</span></span>
              <span>Fats: <span id="fats-value">0g</span></span>
            </div>
            <div class="macro-label">
              <span>Total Calories: <span id="total-calories">0 kcal</span></span>
            </div>
            <div class="meal-division">
              <h4>Suggested Meal Division</h4>
              <div class="meal-item">
                <span>Breakfast (30%)</span>
                <span id="breakfast-calories">0 kcal</span>
              </div>
              <div class="meal-item">
                <span>Lunch (40%)</span>
                <span id="lunch-calories">0 kcal</span>
              </div>
              <div class="meal-item">
                <span>Dinner (30%)</span>
                <span id="dinner-calories">0 kcal</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Unit Converter Section -->
    <div id="units-section" class="section">
      <h2>Unit Converter</h2>
      <div class="unit-section">
        <div class="unit-converter">
          <h3>Volume Converter</h3>
          <div class="unit-group">
            <label for="volume-value">Value:</label>
            <input type="number" id="volume-value" step="0.01">
            <label for="volume-from">From:</label>
            <select id="volume-from">
              <option value="ml">Milliliters (ml)</option>
              <option value="l">Liters (L)</option>
              <option value="oz">Fluid Ounces (fl oz)</option>
              <option value="cup">Cups</option>
              <option value="pint">Pints</option>
              <option value="quart">Quarts</option>
              <option value="gallon">Gallons</option>
              <option value="tbsp">Tablespoons</option>
              <option value="tsp">Teaspoons</option>
            </select>
            <label for="volume-to">To:</label>
            <select id="volume-to">
              <option value="ml">Milliliters (ml)</option>
              <option value="l">Liters (L)</option>
              <option value="oz" selected>Fluid Ounces (fl oz)</option>
              <option value="cup">Cups</option>
              <option value="pint">Pints</option>
              <option value="quart">Quarts</option>
              <option value="gallon">Gallons</option>
              <option value="tbsp">Tablespoons</option>
              <option value="tsp">Teaspoons</option>
            </select>
            <div class="result">
              <h3 id="volume-result">Result: 0</h3>
            </div>
          </div>
    </div>

        <div class="unit-converter">
          <h3>Weight Converter</h3>
          <div class="unit-group">
            <label for="weight-value">Value:</label>
            <input type="number" id="weight-value" step="0.01">
            <label for="weight-from">From:</label>
            <select id="weight-from">
              <option value="g">Grams (g)</option>
              <option value="kg">Kilograms (kg)</option>
              <option value="oz">Ounces (oz)</option>
              <option value="lb">Pounds (lb)</option>
              <option value="mg">Milligrams (mg)</option>
            </select>
            <label for="weight-to">To:</label>
            <select id="weight-to">
              <option value="g">Grams (g)</option>
              <option value="kg">Kilograms (kg)</option>
              <option value="oz" selected>Ounces (oz)</option>
              <option value="lb">Pounds (lb)</option>
              <option value="mg">Milligrams (mg)</option>
            </select>
            <div class="result">
              <h3 id="weight-result">Result: 0</h3>
      </div>
      </div>
      </div>
    </div>
      </div>
    </div>

  <script>
    // Diet data
    const hospitalDiets = [
      {
        name: "Cardiac Diet",
        conditions: ["cardiac", "low-sodium"],
        consistency: "regular",
        description: "Low sodium, low saturated fat diet for heart health",
        macros: { protein: 20, carbs: 55, fats: 25 },
        mealPlan: {
          breakfast: [
            { item: "Oatmeal", portion: "1 cup (240g)", calories: 150, sodium: 0 },
            { item: "Berries", portion: "1/2 cup (75g)", calories: 40, fiber: 4 },
            { item: "Almonds", portion: "1 oz (28g)", calories: 164, protein: 6 }
          ],
          snack1: [
            { item: "Apple", portion: "1 medium (180g)", calories: 95, fiber: 4 },
            { item: "Greek Yogurt", portion: "3/4 cup (170g)", calories: 100, protein: 17 }
          ],
          lunch: [
            { item: "Grilled Chicken", portion: "4 oz (113g)", calories: 165, protein: 31 },
            { item: "Quinoa", portion: "1/2 cup (93g)", calories: 111, fiber: 3 },
            { item: "Steamed Vegetables", portion: "1 cup (150g)", calories: 55, fiber: 4 }
          ],
          snack2: [
            { item: "Carrot Sticks", portion: "1 cup (128g)", calories: 52, fiber: 4 },
            { item: "Hummus", portion: "2 tbsp (30g)", calories: 70, protein: 2 }
          ],
          dinner: [
            { item: "Baked Salmon", portion: "5 oz (142g)", calories: 290, omega3: "2.3g" },
            { item: "Brown Rice", portion: "1/2 cup (98g)", calories: 110, fiber: 2 },
            { item: "Roasted Broccoli", portion: "1 cup (156g)", calories: 55, vitamin_c: "85mg" }
          ]
        }
      },
      {
        name: "Diabetic Diet",
        conditions: ["diabetic"],
        consistency: "regular",
        description: "Controlled carbohydrate diet for blood sugar management",
        macros: { protein: 30, carbs: 40, fats: 30 }
      },
      {
        name: "Renal Diet",
        conditions: ["renal", "low-sodium"],
        consistency: "regular",
        description: "Low sodium, low protein diet for kidney health",
        macros: { protein: 15, carbs: 65, fats: 20 }
      },
      {
        name: "Soft Diet",
        conditions: ["post-surgery", "dental"],
        consistency: "soft",
        description: "Easy to chew and swallow foods for post-surgery or dental patients",
        macros: { protein: 25, carbs: 50, fats: 25 }
      },
      {
        name: "Clear Liquid Diet",
        conditions: ["gi-issues", "pre-surgery"],
        consistency: "liquid",
        description: "Clear liquids only, for pre-surgery or GI issues",
        macros: { protein: 10, carbs: 85, fats: 5 }
      },
      {
        name: "High-Protein Renal",
        conditions: ["renal", "high-protein"],
        consistency: "regular",
        description: "Modified renal diet with increased protein for dialysis patients",
        macros: { protein: 35, carbs: 45, fats: 20 }
      },
      {
        name: "Pureed Diet",
        conditions: ["dysphagia", "post-surgery"],
        consistency: "pureed",
        description: "Smooth, pureed foods for swallowing difficulties",
        macros: { protein: 20, carbs: 55, fats: 25 },
        mealPlan: {
          breakfast: ["Smooth yogurt", "Pureed fruit", "Protein smoothie"],
          lunch: ["Pureed soup", "Mashed potatoes", "Pureed vegetables"],
          dinner: ["Pureed chicken", "Pureed carrots", "Smooth pudding"]
        }
      },
      {
        name: "Low FODMAP Diet",
        conditions: ["ibs", "gut-health"],
        consistency: "regular",
        description: "For IBS and digestive sensitivities",
        macros: { protein: 25, carbs: 50, fats: 25 },
        mealPlan: {
          breakfast: ["Gluten-free oats", "Banana", "Eggs"],
          lunch: ["Grilled chicken", "Rice", "Low FODMAP vegetables"],
          dinner: ["Fish", "Quinoa", "Permitted vegetables"]
        }
      },
      {
        name: "Gluten-Free Diet",
        conditions: ["celiac", "gluten-sensitivity"],
        consistency: "regular",
        description: "Eliminates all sources of gluten for celiac disease and gluten sensitivity",
        allergens: ["wheat"],
        macros: { protein: 25, carbs: 45, fats: 30 }
      },
      {
        name: "Kosher Diet",
        conditions: ["religious"],
        consistency: "regular",
        description: "Follows Jewish dietary laws and restrictions",
        restrictions: ["kosher"],
        macros: { protein: 25, carbs: 50, fats: 25 }
      },
      {
        name: "Halal Diet",
        conditions: ["religious"],
        consistency: "regular",
        description: "Follows Islamic dietary laws and restrictions",
        restrictions: ["halal"],
        macros: { protein: 25, carbs: 50, fats: 25 }
      },
      {
        name: "High-Calcium Diet",
        conditions: ["bone-health", "osteoporosis"],
        consistency: "regular",
        description: "Rich in calcium and vitamin D for bone health",
        nutrients: ["calcium-rich"],
        macros: { protein: 20, carbs: 55, fats: 25 }
      },
      {
        name: "Iron-Rich Diet",
        conditions: ["anemia", "blood-disorders"],
        consistency: "regular",
        description: "High in iron and vitamin C for blood health",
        nutrients: ["iron-rich"],
        macros: { protein: 30, carbs: 45, fats: 25 }
      },
      {
        name: "Anti-Inflammatory Diet",
        conditions: ["inflammation"],
        consistency: "regular",
        description: "Rich in antioxidants and omega-3 fatty acids to reduce inflammation",
        nutrients: ["antioxidant-rich", "omega-3"],
        health: ["anti-inflammatory"],
        macros: { protein: 25, carbs: 40, fats: 35 }
      },
      {
        name: "High-Fiber Diet",
        conditions: ["digestive-health"],
        consistency: "regular",
        description: "High in dietary fiber for digestive health",
        health: ["high-fiber"],
        macros: { protein: 20, carbs: 60, fats: 20 }
      },
      {
        name: "Low-Residue Diet",
        conditions: ["ibd", "crohns"],
        consistency: "regular",
        description: "Low in fiber and residue for IBD and Crohn's disease",
        medical: ["ibd"],
        health: ["low-fiber"],
        macros: { protein: 25, carbs: 50, fats: 25 }
      },
      {
        name: "Gastroparesis Diet",
        conditions: ["delayed-gastric-emptying"],
        consistency: "soft",
        description: "Easy to digest, low-fat diet for delayed gastric emptying",
        medical: ["gastroparesis"],
        health: ["low-fat", "easy-digest"],
        macros: { protein: 20, carbs: 60, fats: 20 }
      },
      {
        name: "Nut-Free Diet",
        conditions: ["nut-allergies"],
        consistency: "regular",
        description: "Eliminates all tree nuts and peanuts for allergy management",
        allergens: ["tree-nuts", "peanuts"],
        macros: { protein: 25, carbs: 50, fats: 25 }
      },
      {
        name: "Dairy-Free Diet",
        conditions: ["lactose-intolerance"],
        consistency: "regular",
        description: "Eliminates all dairy products for lactose intolerance",
        allergens: ["dairy"],
        macros: { protein: 25, carbs: 50, fats: 25 }
      },
      {
        name: "Probiotic Diet",
        conditions: ["gut-health"],
        consistency: "regular",
        description: "Rich in probiotic foods for gut health",
        nutrients: ["probiotic"],
        macros: { protein: 20, carbs: 55, fats: 25 }
      }
    ];

    const popularDiets = [
      {
        name: "Ketogenic Diet",
        goal: "weight-loss",
        description: "High-fat, very low-carb diet for weight loss",
        macros: { protein: 20, carbs: 5, fats: 75 }
      },
      {
        name: "Mediterranean Diet",
        goal: "maintenance",
        description: "Heart-healthy diet rich in whole foods",
        macros: { protein: 25, carbs: 50, fats: 25 }
      },
      {
        name: "High-Protein Diet",
        goal: "muscle-gain",
        description: "Protein-rich diet for muscle building",
        macros: { protein: 40, carbs: 40, fats: 20 }
      },
      {
        name: "Plant-Based Diet",
        goal: "health",
        description: "Whole food plant-based diet for optimal health",
        macros: { protein: 20, carbs: 65, fats: 15 }
      },
      {
        name: "Zone Diet",
        goal: "balance",
        description: "Balanced 40-30-30 ratio of nutrients",
        macros: { protein: 30, carbs: 40, fats: 30 }
      },
      {
        name: "Paleo Diet",
        goal: "weight-loss",
        description: "Based on foods presumed eaten during the Paleolithic era",
        macros: { protein: 35, carbs: 25, fats: 40 }
      },
      {
        name: "DASH Diet",
        goal: "heart-health",
        description: "Dietary Approaches to Stop Hypertension",
        macros: { protein: 25, carbs: 55, fats: 20 },
        mealPlan: {
          breakfast: ["Whole grain toast", "Greek yogurt", "Berries"],
          lunch: ["Grilled fish", "Quinoa", "Leafy greens"],
          dinner: ["Lean chicken", "Sweet potato", "Steamed vegetables"]
        }
      },
      {
        name: "Anti-Inflammatory Diet",
        goal: "inflammation",
        description: "Reduces inflammation and supports immune health",
        macros: { protein: 25, carbs: 45, fats: 30 },
        mealPlan: {
          breakfast: ["Turmeric smoothie", "Chia seeds", "Berries"],
          lunch: ["Salmon", "Brown rice", "Leafy greens"],
          dinner: ["Tofu", "Quinoa", "Cruciferous vegetables"]
        }
      }
    ];

    // Food database
    const foods = {
      protein: [
        {
          name: "Chicken Breast",
          protein: 31,
          carbs: 0,
          fats: 3.6,
          calories: 165,
          category: "protein",
          dietary_info: ["high-protein", "low-carb"],
          nutrients: {
            iron: "1.1mg",
            zinc: "1.0mg",
            b6: "0.6mg",
            b12: "0.3mcg",
            selenium: "27.6mcg"
          }
        },
        {
          name: "Salmon",
          protein: 25,
          carbs: 0,
          fats: 13,
          calories: 208,
          category: "protein",
          dietary_info: ["high-protein", "omega-3"],
          nutrients: {
            omega3: "2.3g",
            vitamin_d: "14.2mcg",
            b12: "2.6mcg",
            selenium: "36.5mcg"
          }
        },
        {
          name: "Tuna",
          protein: 26,
          carbs: 0,
          fats: 0.8,
          calories: 116,
          category: "protein",
          dietary_info: ["high-protein", "low-fat"],
          nutrients: {
            omega3: "1.5g",
            selenium: "65.7mcg",
            b12: "2.5mcg"
          }
        },
        {
          name: "Greek Yogurt",
          protein: 10,
          carbs: 4,
          fats: 0.4,
          calories: 59,
          category: "protein",
          dietary_info: ["probiotic", "calcium-rich"],
          nutrients: {
            calcium: "187mg",
            phosphorus: "218mg",
            potassium: "141mg"
          }
        },
        {
          name: "Lentils",
          protein: 9,
          carbs: 20,
          fats: 0.4,
          calories: 116,
          category: "protein",
          dietary_info: ["plant-based", "high-fiber"],
          nutrients: {
            fiber: "7.9g",
            iron: "3.3mg",
            folate: "179mcg"
          }
        }
      ],
      carbs: [
        {
          name: "Brown Rice",
          protein: 2.6,
          carbs: 23,
          fats: 0.9,
          calories: 112,
          category: "carbs",
          dietary_info: ["whole-grain", "gluten-free"],
          nutrients: {
            fiber: "1.8g",
            magnesium: "43mg",
            phosphorus: "83mg"
          }
        },
        {
          name: "Sweet Potato",
          protein: 2,
          carbs: 20,
          fats: 0.1,
          calories: 86,
          category: "carbs",
          dietary_info: ["low-fat", "vitamin-a-rich"],
          nutrients: {
            fiber: "3g",
            vitamin_a: "14187IU",
            potassium: "337mg"
          }
        },
        {
          name: "Quinoa",
          protein: 4.4,
          carbs: 21.3,
          fats: 1.9,
          calories: 120,
          category: "carbs",
          dietary_info: ["gluten-free", "complete-protein"],
          nutrients: {
            fiber: "2.8g",
            iron: "1.5mg",
            magnesium: "64mg"
          }
        },
        {
          name: "Oatmeal",
          protein: 5,
          carbs: 27,
          fats: 3,
          calories: 150,
          category: "carbs",
          dietary_info: ["whole-grain", "heart-healthy"],
          nutrients: {
            fiber: "4g",
            iron: "1.7mg",
            zinc: "1.3mg"
          }
        }
      ],
      fats: [
        {
          name: "Avocado",
          protein: 2,
          carbs: 9,
          fats: 15,
          calories: 160,
          category: "fats",
          dietary_info: ["healthy-fats", "potassium-rich"],
          nutrients: {
            fiber: "7g",
            potassium: "485mg",
            vitamin_k: "21mcg"
          }
        },
        {
          name: "Almonds",
          protein: 6,
          carbs: 6,
          fats: 14,
          calories: 164,
          category: "fats",
          dietary_info: ["heart-healthy", "vitamin-e-rich"],
          nutrients: {
            fiber: "3.5g",
            vitamin_e: "7.3mg",
            magnesium: "77mg"
          }
        },
        {
          name: "Chia Seeds",
          protein: 4,
          carbs: 8,
          fats: 9,
          calories: 137,
          category: "fats",
          dietary_info: ["omega-3", "high-fiber"],
          nutrients: {
            fiber: "10g",
            calcium: "177mg",
            omega3: "4.9g"
          }
        }
      ],
      vegetables: [
        {
          name: "Spinach",
          protein: 2.9,
          carbs: 3.6,
          fats: 0.4,
          calories: 23,
          category: "vegetables",
          dietary_info: ["leafy-green", "nutrient-dense"],
          nutrients: {
            iron: "2.7mg",
            vitamin_k: "483mcg",
            vitamin_a: "9377IU"
          }
        },
        {
          name: "Broccoli",
          protein: 2.8,
          carbs: 7,
          fats: 0.4,
          calories: 34,
          category: "vegetables",
          dietary_info: ["cruciferous", "vitamin-c-rich"],
          nutrients: {
            fiber: "2.6g",
            vitamin_c: "81.2mg",
            vitamin_k: "92.5mcg"
          }
        },
        {
          name: "Kale",
          protein: 2.9,
          carbs: 5.6,
          fats: 0.5,
          calories: 33,
          category: "vegetables",
          dietary_info: ["leafy-green", "antioxidant-rich"],
          nutrients: {
            vitamin_a: "9990IU",
            vitamin_c: "80.4mg",
            vitamin_k: "547mcg"
          }
        }
      ],
      fruits: [
        {
          name: "Blueberries",
          protein: 0.7,
          carbs: 14,
          fats: 0.3,
          calories: 57,
          category: "fruits",
          dietary_info: ["antioxidant-rich", "low-glycemic"],
          nutrients: {
            fiber: "2.4g",
            vitamin_c: "9.7mg",
            vitamin_k: "19.3mcg"
          }
        },
        {
          name: "Banana",
          protein: 1.3,
          carbs: 27,
          fats: 0.3,
          calories: 105,
          category: "fruits",
          dietary_info: ["potassium-rich", "energy-boost"],
          nutrients: {
            fiber: "3.1g",
            potassium: "422mg",
            vitamin_b6: "0.4mg"
          }
        },
        {
          name: "Apple",
          protein: 0.3,
          carbs: 14,
          fats: 0.2,
          calories: 52,
          category: "fruits",
          dietary_info: ["low-calorie", "heart-healthy"],
          nutrients: {
            fiber: "2.4g",
            vitamin_c: "4.6mg",
            potassium: "107mg"
          }
        }
      ]
    };

    // Unit conversion factors
    const conversionFactors = {
      volume: {
        ml: 1,
        l: 1000,
        oz: 29.5735,
        cup: 236.588,
        pint: 473.176,
        quart: 946.353,
        gallon: 3785.41,
        tbsp: 14.7868,
        tsp: 4.92892,
        floz: 29.5735
      },
      weight: {
        mg: 0.001,
        g: 1,
        kg: 1000,
        oz: 28.3495,
        lb: 453.592,
        mcg: 0.000001,
        stone: 6350.29
      },
      length: {
        mm: 1,
        cm: 10,
        m: 1000,
        inch: 25.4,
        ft: 304.8,
        yd: 914.4
      },
      temperature: {
        celsius: 0,
        fahrenheit: 32,
        kelvin: 273.15,
        conversion: {
          celsiusToFahrenheit: (c) => (c * 9/5) + 32,
          fahrenheitToCelsius: (f) => (f - 32) * 5/9,
          celsiusToKelvin: (c) => c + 273.15,
          kelvinToCelsius: (k) => k - 273.15
        }
      },
      energy: {
        calories: 1,
        kilojoules: 4.184,
        kilocalories: 1000
      },
      pressure: {
        pascal: 1,
        bar: 100000,
        psi: 6894.76,
        mmHg: 133.322
      }
    };

    let menuItems = [];

    // Main section navigation
    function showMainSection(section) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(`${section}-section`).classList.add('active');
      
      document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');

      if (section === 'hospital') {
        renderHospitalDiets();
      } else if (section === 'popular') {
        renderPopularDiets();
      }
    }

    // Diet rendering functions
    function renderHospitalDiets() {
      const container = document.getElementById('hospital-diets');
      container.innerHTML = '';

      const conditionFilter = document.getElementById('condition-filter').value;
      const consistencyFilter = document.getElementById('consistency-filter').value;

      hospitalDiets
        .filter(diet => {
          if (conditionFilter && !diet.conditions.includes(conditionFilter)) return false;
          if (consistencyFilter && diet.consistency !== consistencyFilter) return false;
          return true;
        })
        .forEach(diet => {
          const card = createDietCard(diet);
          container.appendChild(card);
        });
    }

    function renderPopularDiets() {
      const container = document.getElementById('popular-diets');
      container.innerHTML = '';

      const goalFilter = document.getElementById('goal-filter').value;

      popularDiets
        .filter(diet => !goalFilter || diet.goal === goalFilter)
        .forEach(diet => {
          const card = createDietCard(diet);
          container.appendChild(card);
        });
    }

    function createDietCard(diet) {
      const card = document.createElement('div');
      card.className = 'diet-card';
      
      let conditionTags = '';
      if (diet.conditions) {
        conditionTags = `
          <div class="condition-tags">
            ${diet.conditions.map(c => `<span class="tag">${c}</span>`).join('')}
      </div>
        `;
      }

      const macroChart = `
        <div class="macro-chart">
          <div class="macro-segment protein" style="width: ${diet.macros.protein}%"></div>
          <div class="macro-segment carbs" style="width: ${diet.macros.carbs}%"></div>
          <div class="macro-segment fats" style="width: ${diet.macros.fats}%"></div>
      </div>
        <div class="macro-label">
          <span>Protein: ${diet.macros.protein}%</span>
          <span>Carbs: ${diet.macros.carbs}%</span>
          <span>Fats: ${diet.macros.fats}%</span>
      </div>
      `;

      card.innerHTML = `
        <h3>${diet.name}</h3>
        ${conditionTags}
        <p>${diet.description}</p>
        ${macroChart}
      `;

      return card;
    }

    // Menu builder functions
    function searchFoods() {
      const searchTerm = document.getElementById('food-search').value.toLowerCase();
      const category = document.getElementById('food-category').value;
      const resultsContainer = document.getElementById('food-results');
      resultsContainer.innerHTML = '';

      // Get food items from local storage
      const foodItems = JSON.parse(localStorage.getItem('foodItems') || '{}');
      
      let availableFoods = [];
      if (category) {
        availableFoods = foodItems[category] || [];
      } else {
        Object.values(foodItems).forEach(categoryFoods => {
          availableFoods = availableFoods.concat(categoryFoods);
        });
      }

      const filteredFoods = searchTerm
        ? availableFoods.filter(food => 
            food.name.toLowerCase().includes(searchTerm) ||
            (food.nutrients && food.nutrients.some(tag => tag.toLowerCase().includes(searchTerm))) ||
            food.category.toLowerCase().includes(searchTerm)
          )
        : availableFoods;

      if (filteredFoods.length === 0) {
        resultsContainer.innerHTML = '<div class="no-results">No food items found</div>';
        return;
      }

      filteredFoods.forEach(food => {
        const card = createFoodCard(food);
        resultsContainer.appendChild(card);
      });
    }

    function createFoodCard(food) {
      const card = document.createElement('div');
      card.className = 'food-item-card';
      
      card.innerHTML = `
        <div class="card-header">
          <h4>${food.name}</h4>
          <span class="food-category-label">${food.category}</span>
    </div>
        <div class="food-item-details">
          <div class="nutrition-main">
            <p class="calories">Calories: ${food.calories} kcal</p>
            <p class="protein">Protein: ${food.protein}g</p>
            <p class="carbs">Carbs: ${food.carbs}g</p>
            <p class="fats">Fats: ${food.fats}g</p>
          </div>
          <div class="meal-selection">
            <select class="meal-type-select">
              <option value="">Select Meal Type</option>
              <option value="breakfast">Breakfast</option>
              <option value="lunch">Lunch</option>
              <option value="dinner">Dinner</option>
            </select>
            <button onclick="addFoodItemToMenu(
              '${food.name}',
              '${food.category}',
              ${food.protein},
              ${food.carbs},
              ${food.fats},
              ${food.calories},
              this.parentElement.querySelector('.meal-type-select').value,
              event
            )">Add to Menu</button>
          </div>
        </div>
      `;
      
      return card;
    }

    function addFoodItemToMenu(name, category, protein, carbs, fats, calories, mealType, event) {
      event.preventDefault();
      event.stopPropagation();
      
      if (!mealType) {
        alert('Please select a meal type (Breakfast, Lunch, or Dinner)');
        return;
      }

      const menuItem = {
        name,
        category,
        id: Date.now(),
        quantity: 100,
        mealType,
        protein: protein || 0,
        carbs: carbs || 0,
        fats: fats || 0,
        calories: calories || 0
      };

      menuItems.push(menuItem);
      renderMenuItems();
      updateNutritionSummary();
    }

    function removeMenuItem(id) {
      menuItems = menuItems.filter(item => item.id !== id);
      renderMenuItems();
      updateNutritionSummary();
    }

    function updateItemQuantity(id, quantity) {
      const item = menuItems.find(item => item.id === id);
      if (item) {
        item.quantity = Number(quantity);
        updateNutritionSummary();
      }
    }

    // Add menu data structure
    const menuCategories = {
      breakfast: {
        title: "Breakfast Menu",
        items: [
          { name: "Oatmeal with Berries", protein: 8, carbs: 27, fats: 3, calories: 150 },
          { name: "Greek Yogurt Parfait", protein: 15, carbs: 20, fats: 4, calories: 180 },
          { name: "Egg White Omelet", protein: 14, carbs: 2, fats: 1, calories: 120 },
          { name: "Whole Grain Toast", protein: 4, carbs: 15, fats: 1, calories: 80 },
          { name: "Fruit Smoothie", protein: 5, carbs: 25, fats: 2, calories: 140 }
        ]
      },
      lunch: {
        title: "Lunch Menu",
        items: [
          { name: "Grilled Chicken Salad", protein: 25, carbs: 10, fats: 8, calories: 220 },
          { name: "Quinoa Bowl", protein: 12, carbs: 35, fats: 6, calories: 280 },
          { name: "Turkey Sandwich", protein: 20, carbs: 28, fats: 7, calories: 320 },
          { name: "Lentil Soup", protein: 9, carbs: 20, fats: 0.4, calories: 116 },
          { name: "Tuna Wrap", protein: 22, carbs: 25, fats: 9, calories: 290 }
        ]
      },
      dinner: {
        title: "Dinner Menu",
        items: [
          { name: "Salmon Fillet", protein: 25, carbs: 0, fats: 13, calories: 208 },
          { name: "Stir-Fried Tofu", protein: 14, carbs: 8, fats: 6, calories: 180 },
          { name: "Lean Beef Steak", protein: 30, carbs: 0, fats: 15, calories: 250 },
          { name: "Vegetable Curry", protein: 8, carbs: 25, fats: 10, calories: 220 },
          { name: "Grilled Fish", protein: 22, carbs: 0, fats: 10, calories: 180 }
        ]
      }
    };

    // Add this to your existing renderMenuItems function
    function renderMenuItems() {
      const container = document.getElementById('menu-items');
      container.innerHTML = '<h3>Selected Items</h3>';

      // Group items by meal type
      const mealGroups = {
        breakfast: [],
        lunch: [],
        dinner: []
      };

      menuItems.forEach(item => {
        if (mealGroups[item.mealType]) {
          mealGroups[item.mealType].push(item);
        }
      });

      // Render items by meal type
      Object.entries(mealGroups).forEach(([mealType, items]) => {
        if (items.length > 0) {
          const mealDiv = document.createElement('div');
          mealDiv.className = 'meal-group';
          mealDiv.innerHTML = `
            <h4>${mealType.charAt(0).toUpperCase() + mealType.slice(1)}</h4>
            <div class="meal-items">
              ${items.map(item => `
                <div class="food-item">
                  <div class="food-item-info">
                    <strong>${item.name}</strong>
                    <span class="calories-info">${Math.round(item.calories * (item.quantity / 100))} kcal</span>
      </div>
                  <div class="food-item-controls">
                    <input type="number" 
                      value="${item.quantity}" 
                      onchange="updateItemQuantity(${item.id}, this.value)"
                      min="0" 
                      step="10">
                    <span>g</span>
                    <button onclick="removeMenuItem(${item.id})">Remove</button>
      </div>
      </div>
              `).join('')}
    </div>
          `;
          container.appendChild(mealDiv);
        }
      });

      // Update meal division in nutrition summary
      updateMealDivision();
    }

    function updateMealDivision() {
      const mealTotals = {
        breakfast: 0,
        lunch: 0,
        dinner: 0
      };

      menuItems.forEach(item => {
        const calories = item.calories * (item.quantity / 100);
        if (mealTotals[item.mealType] !== undefined) {
          mealTotals[item.mealType] += calories;
        }
      });

      // Update the meal division display
      document.getElementById('breakfast-calories').textContent = `${Math.round(mealTotals.breakfast)} kcal`;
      document.getElementById('lunch-calories').textContent = `${Math.round(mealTotals.lunch)} kcal`;
      document.getElementById('dinner-calories').textContent = `${Math.round(mealTotals.dinner)} kcal`;
    }

    function updateNutritionSummary() {
      let totals = {
        protein: 0,
        carbs: 0,
        fats: 0,
        calories: 0
      };

      // Calculate totals for each meal type
      const mealTotals = {
        breakfast: 0,
        lunch: 0,
        dinner: 0
      };

      menuItems.forEach(item => {
        const multiplier = item.quantity / 100;
        totals.protein += (item.protein || 0) * multiplier;
        totals.carbs += (item.carbs || 0) * multiplier;
        totals.fats += (item.fats || 0) * multiplier;
        totals.calories += (item.calories || 0) * multiplier;

        // Add to meal type totals
        if (item.mealType && mealTotals.hasOwnProperty(item.mealType)) {
          mealTotals[item.mealType] += (item.calories || 0) * multiplier;
        }
      });

      // Update macro distribution bars
      const totalMacros = totals.protein + totals.carbs + totals.fats;
      if (totalMacros > 0) {
        document.getElementById('protein-bar').style.width = `${(totals.protein / totalMacros) * 100}%`;
        document.getElementById('carbs-bar').style.width = `${(totals.carbs / totalMacros) * 100}%`;
        document.getElementById('fats-bar').style.width = `${(totals.fats / totalMacros) * 100}%`;
      } else {
        document.getElementById('protein-bar').style.width = '0%';
        document.getElementById('carbs-bar').style.width = '0%';
        document.getElementById('fats-bar').style.width = '0%';
      }

      // Update nutrition values
      document.getElementById('protein-value').textContent = `${Math.round(totals.protein)}g`;
      document.getElementById('carbs-value').textContent = `${Math.round(totals.carbs)}g`;
      document.getElementById('fats-value').textContent = `${Math.round(totals.fats)}g`;
      document.getElementById('total-calories').textContent = `${Math.round(totals.calories)} kcal`;

      // Update meal division display
      document.getElementById('breakfast-calories').textContent = `${Math.round(mealTotals.breakfast)} kcal`;
      document.getElementById('lunch-calories').textContent = `${Math.round(mealTotals.lunch)} kcal`;
      document.getElementById('dinner-calories').textContent = `${Math.round(mealTotals.dinner)} kcal`;
    }

    // Unit conversion functions
    function convertTemperature(value, fromUnit, toUnit) {
      const conversions = conversionFactors.temperature.conversion;
      
      if (fromUnit === toUnit) return value;
      
      if (fromUnit === 'celsius') {
        if (toUnit === 'fahrenheit') return conversions.celsiusToFahrenheit(value);
        if (toUnit === 'kelvin') return conversions.celsiusToKelvin(value);
      }
      // ... add other temperature conversion cases
    }

    function convertUnits(type) {
      const value = parseFloat(document.getElementById(`${type}-value`).value) || 0;
      const fromUnit = document.getElementById(`${type}-from`).value;
      const toUnit = document.getElementById(`${type}-to`).value;
      const foodType = document.getElementById(`${type}-food-type`)?.value;

      let result;
      if (type === 'cooking') {
        result = convertPortion(value, fromUnit, toUnit, foodType);
      } else if (type === 'temperature') {
        result = convertTemperature(value, fromUnit, toUnit);
      } else {
        const baseValue = value * conversionFactors[type][fromUnit];
        result = baseValue / conversionFactors[type][toUnit];
      }

      document.getElementById(`${type}-result`).textContent = 
        `Result: ${result.toFixed(2)} ${toUnit}`;
    }

    // Event listeners for unit conversion
    document.getElementById('volume-value').addEventListener('input', () => convertUnits('volume'));
    document.getElementById('volume-from').addEventListener('change', () => convertUnits('volume'));
    document.getElementById('volume-to').addEventListener('change', () => convertUnits('volume'));

    document.getElementById('weight-value').addEventListener('input', () => convertUnits('weight'));
    document.getElementById('weight-from').addEventListener('change', () => convertUnits('weight'));
    document.getElementById('weight-to').addEventListener('change', () => convertUnits('weight'));

    // Initialize
    renderHospitalDiets();

    // Add these translations at the top of your script
    const translations = {
      en: {
        hospitalDiets: "Hospital Diets",
        popularDiets: "Popular Diets",
        customMenu: "Custom Menu",
        unitConverter: "Unit Converter",
        addFoodItem: "Add Item",
        searchFoods: "Search foods...",
        allCategories: "All Categories",
        proteins: "Proteins",
        carbohydrates: "Carbohydrates",
        fats: "Fats",
        vegetables: "Vegetables",
        fruits: "Fruits",
        nutritionSummary: "Nutrition Summary",
        totalCalories: "Total Calories",
        remove: "Remove",
        result: "Result",
        value: "Value",
        from: "From",
        to: "To",
        allConditions: "All Conditions",
        diabeticFriendly: "Diabetic-Friendly",
        cardiacSafe: "Cardiac-Safe",
        renalSafe: "Renal-Safe",
        lowSodium: "Low Sodium"
      },
      es: {
        hospitalDiets: "Dietas Hospitalarias",
        popularDiets: "Dietas Populares",
        customMenu: "Menú Personalizado",
        unitConverter: "Conversor de Unidades",
        addFoodItem: "Agregar",
        searchFoods: "Buscar alimentos...",
        allCategories: "Todas las Categorías",
        proteins: "Proteínas",
        carbohydrates: "Carbohidratos",
        fats: "Grasas",
        vegetables: "Verduras",
        fruits: "Frutas",
        nutritionSummary: "Resumen Nutricional",
        totalCalories: "Calorías Totales",
        remove: "Eliminar",
        result: "Resultado",
        value: "Valor",
        from: "De",
        to: "A",
        allConditions: "Todas las Condiciones",
        diabeticFriendly: "Apto para Diabéticos",
        cardiacSafe: "Seguro Cardíaco",
        renalSafe: "Seguro Renal",
        lowSodium: "Bajo en Sodio"
      },
      fr: {
        hospitalDiets: "Régimes Hospitaliers",
        popularDiets: "Régimes Populaires",
        customMenu: "Menu Personnalisé",
        unitConverter: "Convertisseur d'Unités",
        addFoodItem: "Ajouter un Aliment",
        searchFoods: "Rechercher des aliments...",
        allCategories: "Toutes les Catégories",
        proteins: "Protéines",
        carbohydrates: "Glucides",
        fats: "Lipides",
        vegetables: "Légumes",
        fruits: "Fruits",
        nutritionSummary: "Résumé Nutritionnel",
        totalCalories: "Calories Totales",
        remove: "Supprimer",
        result: "Résultat",
        value: "Valeur",
        from: "De",
        to: "À",
        allConditions: "Toutes les Conditions",
        diabeticFriendly: "Adapté aux Diabétiques",
        cardiacSafe: "Sécuritaire Cardiaque",
        renalSafe: "Sécuritaire Rénal",
        lowSodium: "Faible en Sodium"
      },
      de: {
        hospitalDiets: "Krankenhaus-Diäten",
        popularDiets: "Beliebte Diäten",
        customMenu: "Eigenes Menü",
        unitConverter: "Einheitenrechner",
        addFoodItem: "Lebensmittel Hinzufügen",
        searchFoods: "Lebensmittel suchen...",
        allCategories: "Alle Kategorien",
        proteins: "Proteine",
        carbohydrates: "Kohlenhydrate",
        fats: "Fette",
        vegetables: "Gemüse",
        fruits: "Obst",
        nutritionSummary: "Ernährungsübersicht",
        totalCalories: "Gesamtkalorien",
        remove: "Entfernen",
        result: "Ergebnis",
        value: "Wert",
        from: "Von",
        to: "Nach",
        allConditions: "Alle Bedingungen",
        diabeticFriendly: "Diabetikergeeignet",
        cardiacSafe: "Herzsicher",
        renalSafe: "Nierensicher",
        lowSodium: "Natriumarm"
      },
      zh: {
        hospitalDiets: "医院饮食",
        popularDiets: "流行饮食",
        customMenu: "自定义菜单",
        unitConverter: "单位转换器",
        addFoodItem: "添加食物",
        searchFoods: "搜索食物...",
        allCategories: "所有类别",
        proteins: "蛋白质",
        carbohydrates: "碳水化合物",
        fats: "脂肪",
        vegetables: "蔬菜",
        fruits: "水果",
        nutritionSummary: "营养摘要",
        totalCalories: "总卡路里",
        remove: "删除",
        result: "结果",
        value: "数值",
        from: "从",
        to: "到",
        allConditions: "所有条件",
        diabeticFriendly: "适合糖尿病",
        cardiacSafe: "心脏安全",
        renalSafe: "肾脏安全",
        lowSodium: "低钠"
      },
      ar: {
        hospitalDiets: "حميات المستشفى",
        popularDiets: "حميات شائعة",
        customMenu: "قائمة مخصصة",
        unitConverter: "محول الوحدات",
        addFoodItem: "إضافة طعام",
        searchFoods: "بحث عن الأطعمة...",
        allCategories: "جميع الفئات",
        proteins: "البروتينات",
        carbohydrates: "الكربوهيدرات",
        fats: "الدهون",
        vegetables: "الخضروات",
        fruits: "الفواكه",
        nutritionSummary: "ملخص التغذية",
        totalCalories: "إجمالي السعرات",
        remove: "إزالة",
        result: "النتيجة",
        value: "القيمة",
        from: "من",
        to: "إلى",
        allConditions: "جميع الحالات",
        diabeticFriendly: "مناسب لمرضى السكري",
        cardiacSafe: "آمن للقلب",
        renalSafe: "آمن للكلى",
        lowSodium: "قليل الصوديوم"
      },
      ko: {
        hospitalDiets: "병원 식단",
        popularDiets: "인기 식단",
        customMenu: "맞춤 메뉴",
        unitConverter: "단위 변환기",
        addFoodItem: "음식 추가",
        searchFoods: "음식 검색...",
        allCategories: "모든 카테고리",
        proteins: "단백질",
        carbohydrates: "탄수화물",
        fats: "지방",
        vegetables: "채소",
        fruits: "과일",
        nutritionSummary: "영양 요약",
        totalCalories: "총 칼로리",
        remove: "제거",
        result: "결과",
        value: "값",
        from: "시작",
        to: "끝"
      },
      ja: {
        hospitalDiets: "病院食",
        popularDiets: "人気の食事",
        customMenu: "カスタムメニュー",
        unitConverter: "単位変換",
        addFoodItem: "食品追加",
        searchFoods: "食品を検索...",
        allCategories: "すべてのカテゴリー",
        proteins: "タンパク質",
        carbohydrates: "炭水化物",
        fats: "脂肪",
        vegetables: "野菜",
        fruits: "果物",
        nutritionSummary: "栄養概要",
        totalCalories: "総カロリー",
        remove: "削除",
        result: "結果",
        value: "値",
        from: "から",
        to: "まで"
      },
      it: {
        hospitalDiets: "Diete Ospedaliere",
        popularDiets: "Diete Popolari",
        customMenu: "Menú Personalizado",
        unitConverter: "Conversor de Unidades",
        addFoodItem: "Aggiungere un Alimento",
        searchFoods: "Cerca alimenti...",
        allCategories: "Tutte le Categorie",
        proteins: "Proteine",
        carbohydrates: "Carboidrati",
        fats: "Grassi",
        vegetables: "Verdure",
        fruits: "Frutta",
        nutritionSummary: "Sommario Nutrizionale",
        totalCalories: "Calorie Totali",
        remove: "Rimuovere",
        result: "Risultato",
        value: "Valore",
        from: "Da",
        to: "A",
        allConditions: "Tutte le Condizioni",
        diabeticFriendly: "Adatta per Diabetici",
        cardiacSafe: "Cardiaco Sicuro",
        renalSafe: "Renale Sicura",
        lowSodium: "Bassa in Sodio"
      },
      pt: {
        hospitalDiets: "Dietas Hospitalares",
        popularDiets: "Dietas Populares",
        customMenu: "Menu Personalizado",
        unitConverter: "Conversor de Unidades",
        addFoodItem: "Adicionar Item",
        searchFoods: "Pesquisar Itens...",
        allCategories: "Todas as Categorias",
        proteins: "Proteínas",
        carbohydrates: "Carboidratos",
        fats: "Gorduras",
        vegetables: "Vegetais",
        fruits: "Frutas",
        nutritionSummary: "Resumo Nutricional",
        totalCalories: "Calorias Totais",
        remove: "Remover",
        result: "Resultado",
        value: "Valor",
        from: "De",
        to: "Para"
      },
      hi: {
        hospitalDiets: "अस्पताल आहार",
        popularDiets: "लोकप्रिय आहार",
        customMenu: "अनुकूल मेनू",
        unitConverter: "इकाई कनवर्टर",
        addFoodItem: "आइटम जोड़ें",
        searchFoods: "आइटम खोजें...",
        allCategories: "सभी श्रेणियाँ",
        proteins: "प्रोटीन",
        carbohydrates: "कार्बोहाइड्रेट",
        fats: "वसा",
        vegetables: "सब्जी",
        fruits: "फल",
        nutritionSummary: "पोषण सारांश",
        totalCalories: "कुल कैलोरी",
        remove: "निकालें",
        result: "परिणाम",
        value: "मूल्य",
        from: "से",
        to: "तक"
      }
    };

    // Theme and Language Management
    function changeTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
    }

    function changeLanguage(lang) {
      const isRTL = lang === 'ar';
      document.documentElement.setAttribute('lang', lang);
      document.body.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
      localStorage.setItem('language', lang);
      updatePageText(lang);
      updateUIForRTL(isRTL);
    }

    function updatePageText(lang) {
      const t = translations[lang];
      
      // Update navigation buttons
      document.querySelectorAll('.nav-button').forEach((btn, index) => {
        const keys = ['hospitalDiets', 'popularDiets', 'customMenu', 'unitConverter'];
        btn.textContent = t[keys[index]];
      });

      // Update section titles
      document.querySelectorAll('h2').forEach(h2 => {
        const key = h2.textContent.toLowerCase().replace(/\s+/g, '');
        if (t[key]) h2.textContent = t[key];
      });

      // Update food category options
      const foodCategory = document.getElementById('food-category');
      if (foodCategory) {
        foodCategory.options[0].text = t.allCategories;
        foodCategory.options[1].text = t.proteins;
        foodCategory.options[2].text = t.carbohydrates;
        foodCategory.options[3].text = t.fats;
        foodCategory.options[4].text = t.vegetables;
        foodCategory.options[5].text = t.fruits;
      }

      // Update condition filter options
      const conditionFilter = document.getElementById('condition-filter');
      if (conditionFilter) {
        conditionFilter.options[0].text = t.allConditions;
        conditionFilter.options[1].text = t.diabeticFriendly;
        conditionFilter.options[2].text = t.cardiacSafe;
        conditionFilter.options[3].text = t.renalSafe;
        conditionFilter.options[4].text = t.lowSodium;
      }

      // Update placeholders and labels
      document.getElementById('food-search').placeholder = t.searchFoods;
      document.querySelector('.summary-card h3').textContent = t.nutritionSummary;
      document.querySelector('.macro-label:last-child span:first-child').textContent = t.totalCalories;

      // Update buttons
      document.querySelectorAll('button').forEach(btn => {
        if (btn.textContent === 'Add Item') btn.textContent = t.addFoodItem;
        if (btn.textContent === 'Remove') btn.textContent = t.remove;
      });
    }

    // Initialize theme and language from localStorage or defaults
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      const savedLanguage = localStorage.getItem('language') || 'en';
      
      document.getElementById('theme-select').value = savedTheme;
      document.getElementById('language-select').value = savedLanguage;
      
      changeTheme(savedTheme);
      changeLanguage(savedLanguage);
    });

    // Enhanced theme and language management
    function updateUIForRTL(isRTL) {
      const elements = {
        '.diet-card': { textAlign: isRTL ? 'right' : 'left' },
        '.food-item-controls': { flexDirection: isRTL ? 'row-reverse' : 'row' },
        '.macro-label': { flexDirection: isRTL ? 'row-reverse' : 'row' },
        '.condition-tags': { justifyContent: isRTL ? 'flex-end' : 'flex-start' }
      };

      Object.entries(elements).forEach(([selector, styles]) => {
        document.querySelectorAll(selector).forEach(el => {
          Object.entries(styles).forEach(([prop, value]) => {
            el.style[prop] = value;
      });
    });
      });
    }

    // Add specialized unit conversions for cooking
    const cookingConversions = {
      us_metric: {
        cup_to_ml: 236.588,
        tbsp_to_ml: 14.7868,
        tsp_to_ml: 4.92892,
        oz_to_g: 28.3495,
        lb_to_kg: 0.453592
      },
      temperature: {
        fahrenheit_to_celsius: (f) => (f - 32) * 5/9,
        celsius_to_fahrenheit: (c) => (c * 9/5) + 32,
        gas_mark_to_celsius: {
          "1/4": 110,
          "1/2": 120,
          "1": 135,
          "2": 150,
          "3": 165,
          "4": 180,
          "5": 190,
          "6": 200,
          "7": 220,
          "8": 230,
          "9": 240,
          "10": 260
        }
      },
      portion_sizes: {
        cup: {
          rice_uncooked: { grams: 185, calories: 670 },
          rice_cooked: { grams: 158, calories: 205 },
          pasta_uncooked: { grams: 100, calories: 371 },
          pasta_cooked: { grams: 140, calories: 200 },
          vegetables_raw: { grams: 90, calories: 25 },
          vegetables_cooked: { grams: 160, calories: 40 }
        }
      }
    };

    // Add nutrition calculation functions
    function calculateNutrition(ingredients) {
      let totals = {
        calories: 0,
        protein: 0,
        carbs: 0,
        fats: 0,
        fiber: 0,
        sodium: 0,
        vitamins: {},
        minerals: {}
      };

      ingredients.forEach(ing => {
        const food = foods[ing.category].find(f => f.name === ing.name);
        const portionMultiplier = ing.amount / 100; // Convert to 100g base

        totals.calories += food.calories * portionMultiplier;
        totals.protein += food.protein * portionMultiplier;
        totals.carbs += food.carbs * portionMultiplier;
        totals.fats += food.fats * portionMultiplier;

        if (food.nutrients) {
          // Add micronutrients
          Object.entries(food.nutrients).forEach(([nutrient, value]) => {
            if (typeof value === 'number') {
              totals.minerals[nutrient] = (totals.minerals[nutrient] || 0) + value * portionMultiplier;
            }
          });
        }
      });

      return totals;
    }

    // Add portion conversion function
    function convertPortion(amount, fromUnit, toUnit, foodType) {
      const portions = cookingConversions.portion_sizes;
      
      if (portions[fromUnit] && portions[fromUnit][foodType]) {
        const baseGrams = portions[fromUnit][foodType].grams;
        if (portions[toUnit] && portions[toUnit][foodType]) {
          return (amount * baseGrams) / portions[toUnit][foodType].grams;
        }
      }
      
      // Default to direct conversion if specific food type conversion not available
      return amount * cookingConversions.us_metric[`${fromUnit}_to_${toUnit}`];
    }

    // Initialize filters
    function initializeFilters() {
      const filterContainer = document.querySelector('.filters');
      
      Object.entries(filters).forEach(([category, options]) => {
        const filterGroup = document.createElement('div');
        filterGroup.className = 'filter-group';
        
        const select = document.createElement('select');
        select.id = `${category}-filter`;
        select.multiple = true;
        
        options.forEach(option => {
          const opt = document.createElement('option');
          opt.value = option;
          opt.textContent = option.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
          select.appendChild(opt);
        });
        
        filterGroup.appendChild(select);
        filterContainer.appendChild(filterGroup);
      });
    }

    // Initialize the application with new features
    document.addEventListener('DOMContentLoaded', () => {
      // ... existing initialization ...
      
      // Initialize enhanced filters
      initializeFilters();
      
      // Add event listeners for cooking conversions
      ['cooking', 'temperature'].forEach(type => {
        document.getElementById(`${type}-value`)?.addEventListener('input', () => convertUnits(type));
        document.getElementById(`${type}-from`)?.addEventListener('change', () => convertUnits(type));
        document.getElementById(`${type}-to`)?.addEventListener('change', () => convertUnits(type));
        document.getElementById(`${type}-food-type`)?.addEventListener('change', () => convertUnits(type));
      });
    });

    // Add text-to-speech functionality
    function speakText(text, options = {}) {
      const utterance = new SpeechSynthesisUtterance(text);
      const lang = document.documentElement.getAttribute('lang');
      
      utterance.lang = lang;
      utterance.rate = options.rate || 1;
      utterance.pitch = options.pitch || 1;
      utterance.volume = options.volume || 1;
      
      // Add nutritional information to speech
      if (options.includeNutrition) {
        const food = Object.values(foods)
          .flat()
          .find(f => f.name === text);
        
        if (food) {
          const nutritionText = `
            ${food.name} contains ${food.calories} calories,
            ${food.protein} grams of protein,
            ${food.carbs} grams of carbohydrates, and
            ${food.fats} grams of fat per 100 grams.
          `;
          utterance.text = nutritionText;
        }
      }
      
      window.speechSynthesis.speak(utterance);
    }

    // Add quick-add portion functionality
    function quickAddPortion(foodName, portionSize, calories) {
      event.stopPropagation();
      const food = Object.values(foods)
        .flat()
        .find(f => f.name === foodName);
      
      if (food) {
        const match = portionSize.match(/(\d+)\s*(\w+)/);
        const amount = match ? parseFloat(match[1]) : 100;
        
        const menuItem = {
          ...food,
          quantity: amount,
          id: Date.now(),
          portionSize: portionSize,
          calories: calories
        };
        
        menuItems.push(menuItem);
        renderMenuItems();
        updateNutritionSummary();
      }
    }

    // Add sorting functionality
    function sortFoodItems(foods, criteria = 'name') {
      return [...foods].sort((a, b) => {
        switch(criteria) {
          case 'name':
            return a.name.localeCompare(b.name);
          case 'calories':
            return b.calories - a.calories;
          case 'protein':
            return b.protein - a.protein;
          case 'carbs':
            return b.carbs - a.carbs;
          case 'fats':
            return b.fats - a.fats;
          case 'protein_density':
            return (b.protein / b.calories) - (a.protein / a.calories);
          case 'nutrient_density':
            return calculateWeightedNutrientDensity(b) - calculateWeightedNutrientDensity(a);
          default:
            return 0;
        }
      });
    }

    // Add nutrient density calculation
    function calculateNutrientDensity(foodCard) {
      const nutrients = foodCard.querySelectorAll('.nutrients-grid p');
      const calories = parseFloat(foodCard.querySelector('.calories').textContent);
      let score = 0;
      
      nutrients.forEach(nutrient => {
        const value = parseFloat(nutrient.textContent.match(/[\d.]+/)[0]);
        score += value;
      });
      
      return score / calories;
    }

    // Add specialized dietary tags and filters
    const dietaryTags = {
      allergens: ["dairy", "eggs", "fish", "shellfish", "tree-nuts", "peanuts", "wheat", "soy"],
      restrictions: ["vegan", "vegetarian", "pescatarian", "halal", "kosher"],
      health: ["low-sodium", "low-fat", "low-carb", "high-protein", "high-fiber"],
      medical: ["diabetes-friendly", "heart-healthy", "renal-friendly", "low-fodmap"],
      lifestyle: ["keto", "paleo", "mediterranean", "whole-food", "raw"],
      nutrients: ["iron-rich", "calcium-rich", "omega-3", "antioxidant-rich", "probiotic"]
    };

    // Add nutrient density calculation with weighted scores
    const nutrientWeights = {
      protein: 2.0,
      fiber: 1.8,
      iron: 1.5,
      calcium: 1.5,
      vitamin_d: 1.5,
      omega3: 1.5,
      vitamin_b12: 1.3,
      zinc: 1.2,
      magnesium: 1.2,
      potassium: 1.2,
      vitamin_c: 1.1,
      vitamin_a: 1.1,
      vitamin_e: 1.1,
      selenium: 1.0,
      phosphorus: 1.0,
      sodium: -0.5,  // Negative weight for sodium
      saturated_fat: -0.3  // Negative weight for saturated fat
    };

    function calculateWeightedNutrientDensity(food) {
      let score = 0;
      let totalWeight = 0;

      // Calculate protein score
      score += (food.protein / food.calories) * 100 * nutrientWeights.protein;
      totalWeight += nutrientWeights.protein;

      // Calculate other nutrient scores
      if (food.nutrients) {
        Object.entries(food.nutrients).forEach(([nutrient, value]) => {
          if (nutrientWeights[nutrient]) {
            const numericValue = parseFloat(value.match(/[\d.]+/)[0]);
            score += (numericValue / food.calories) * 100 * nutrientWeights[nutrient];
            totalWeight += Math.abs(nutrientWeights[nutrient]);
          }
        });
      }

      return score / totalWeight;
    }

    // Add voice command support
    const voiceCommands = {
      navigation: {
        "show hospital diets": () => showMainSection('hospital'),
        "show popular diets": () => showMainSection('popular'),
        "show custom menu": () => showMainSection('custom'),
        "show unit converter": () => showMainSection('units'),
        "go back": () => window.history.back(),
        "scroll up": () => window.scrollTo({ top: 0, behavior: 'smooth' }),
        "scroll down": () => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' })
      },
      filters: {
        "show all foods": () => {
          document.getElementById('food-category').value = '';
          searchFoods();
        },
        "show proteins": () => {
          document.getElementById('food-category').value = 'protein';
          searchFoods();
        },
        "show carbs": () => {
          document.getElementById('food-category').value = 'carbs';
          searchFoods();
        },
        "sort by calories": () => sortFoodItems('calories'),
        "sort by protein": () => sortFoodItems('protein'),
        "sort by nutrient density": () => sortFoodItems('nutrient_density')
      },
      theme: {
        "light theme": () => changeTheme('light'),
        "dark theme": () => changeTheme('dark'),
        "high contrast": () => changeTheme('high-contrast')
      }
    };

    // Initialize voice recognition
    function initializeVoiceCommands() {
      if ('webkitSpeechRecognition' in window) {
        const recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = false;
        recognition.lang = document.documentElement.getAttribute('lang');

        recognition.onresult = (event) => {
          const command = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
          
          // Check navigation commands
          Object.entries(voiceCommands.navigation).forEach(([key, func]) => {
            if (command.includes(key)) {
              func();
              speakText('Navigating to ' + key);
            }
          });

          // Check filter commands
          Object.entries(voiceCommands.filters).forEach(([key, func]) => {
            if (command.includes(key)) {
              func();
              speakText('Applying filter: ' + key);
            }
          });

          // Check theme commands
          Object.entries(voiceCommands.theme).forEach(([key, func]) => {
            if (command.includes(key)) {
              func();
              speakText('Changing theme to ' + key);
            }
          });
        };

        recognition.onerror = (event) => {
          console.error('Voice recognition error:', event.error);
        };

        // Add voice control button to navigation
        const navControls = document.querySelector('.settings-controls');
        const voiceButton = document.createElement('button');
        voiceButton.className = 'voice-control-btn';
        voiceButton.innerHTML = '<i class="fas fa-microphone"></i>';
        voiceButton.title = 'Voice Control';
        
        let isListening = false;
        voiceButton.onclick = () => {
          if (!isListening) {
            recognition.start();
            voiceButton.classList.add('active');
            speakText('Voice control activated');
          } else {
            recognition.stop();
            voiceButton.classList.remove('active');
            speakText('Voice control deactivated');
          }
          isListening = !isListening;
        };
        
        navControls.appendChild(voiceButton);
      }
    }

    // Initialize the application with new features
    document.addEventListener('DOMContentLoaded', () => {
      // ... existing initialization ...
      
      // Initialize voice commands
      initializeVoiceCommands();
      
      // Create dietary filter UI
      const filterContainer = document.querySelector('.filters');
      const dietaryFiltersDiv = document.createElement('div');
      dietaryFiltersDiv.className = 'dietary-filters';
      
      // Add summary div
      const summaryDiv = document.createElement('div');
      summaryDiv.id = 'filter-summary';
      summaryDiv.style.margin = '15px 0';
      summaryDiv.style.padding = '10px';
      summaryDiv.style.backgroundColor = 'var(--container-bg)';
      summaryDiv.style.borderRadius = '8px';
      summaryDiv.style.display = 'none';
      filterContainer.appendChild(summaryDiv);
      
      Object.entries(dietaryTags).forEach(([category, tags]) => {
        const filterGroup = document.createElement('div');
        filterGroup.className = 'dietary-filter-group';
        filterGroup.innerHTML = `
          <h4>${category.charAt(0).toUpperCase() + category.slice(1)}</h4>
          <div class="dietary-tag-list">
            ${tags.map(tag => `
              <div class="dietary-tag">
                <input type="checkbox" id="${tag}" class="dietary-tag-checkbox" value="${tag}">
                <label for="${tag}" class="dietary-tag-label">${tag.replace(/-/g, ' ')}</label>
    </div>
            `).join('')}
  </div>
        `;
        dietaryFiltersDiv.appendChild(filterGroup);
      });
      
      filterContainer.appendChild(dietaryFiltersDiv);
      
      // Add event listeners for dietary tag checkboxes
      Object.values(dietaryTags).flat().forEach(tag => {
        const checkbox = document.getElementById(tag);
        if (checkbox) {
          checkbox.addEventListener('change', filterDiets);
        }
      });
    });

    // Add viewport-based JavaScript adjustments
    function adjustLayoutForViewport() {
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      
      // Adjust food results height based on viewport
      const foodResults = document.querySelector('.food-results');
      if (foodResults) {
        if (vw < 768) {
          foodResults.style.maxHeight = '40vh';
        } else {
          foodResults.style.maxHeight = '60vh';
        }
      }

      // Adjust summary card position
      const summaryCard = document.querySelector('.summary-card');
      if (summaryCard) {
        if (vw < 768) {
          summaryCard.style.position = 'relative';
          summaryCard.style.top = '0';
        } else {
          summaryCard.style.position = 'sticky';
          summaryCard.style.top = '20px';
        }
      }
    }

    // Call on load and resize
    window.addEventListener('load', adjustLayoutForViewport);
    window.addEventListener('resize', adjustLayoutForViewport);

    // Add touch event handling
    if ('ontouchstart' in window) {
      document.body.classList.add('touch-device');
    }

    // Update the selection functions
    function filterDiets() {
      const goalFilter = document.getElementById('goal-filter')?.value;
      const conditionFilter = document.getElementById('condition-filter')?.value;
      const consistencyFilter = document.getElementById('consistency-filter')?.value;
      const activeSection = document.querySelector('.section.active').id;
      
      // Get all selected dietary tags
      const selectedTags = {
        allergens: [],
        restrictions: [],
        health: [],
        medical: [],
        lifestyle: [],
        nutrients: []
      };
      
      Object.keys(dietaryTags).forEach(category => {
        dietaryTags[category].forEach(tag => {
          const checkbox = document.getElementById(tag);
          if (checkbox && checkbox.checked) {
            selectedTags[category].push(tag);
          }
        });
      });
      
      // Update summary display
      updateFilterSummary(selectedTags);

      if (activeSection === 'hospital-section') {
        const container = document.getElementById('hospital-diets');
        container.innerHTML = '';

        const filteredDiets = hospitalDiets.filter(diet => {
          // Check condition filter
          if (conditionFilter && conditionFilter !== 'All Conditions' && 
              (!diet.conditions || !diet.conditions.includes(conditionFilter))) {
            return false;
          }

          // Check consistency filter
          if (consistencyFilter && consistencyFilter !== 'All Consistencies' && 
              diet.consistency !== consistencyFilter) {
            return false;
          }

          // Check dietary tags
          for (const [category, tags] of Object.entries(selectedTags)) {
            if (tags.length > 0) {
              // If diet doesn't have the category property, initialize it as empty array
              const dietTags = diet[category] || [];
              
              // For allergens, if diet has any of the selected allergens, exclude it
              if (category === 'allergens') {
                if (tags.some(tag => dietTags.includes(tag))) {
                  return false;
                }
              } else {
                // For other categories, diet must include at least one of the selected tags
                if (!tags.some(tag => dietTags.includes(tag))) {
                  return false;
                }
              }
            }
          }
          
          return true;
        });

        // Display filtered diets or show message if none found
        if (filteredDiets.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 20px; color: var(--text-color);">
              No diets match the selected filters. Try adjusting your selections.
            </div>
          `;
        } else {
          filteredDiets.forEach(diet => {
            const card = createDietCard(diet);
            container.appendChild(card);
          });
        }
      } else if (activeSection === 'popular-section') {
        const container = document.getElementById('popular-diets');
        container.innerHTML = '';

        popularDiets
          .filter(diet => !goalFilter || diet.goal === goalFilter)
          .forEach(diet => {
            const card = createDietCard(diet);
            container.appendChild(card);
          });
      }
    }

    // Helper function to update filter summary
    function updateFilterSummary(selectedTags) {
      const summaryDiv = document.getElementById('filter-summary');
      const hasSelectedTags = Object.values(selectedTags).some(arr => arr.length > 0);
      
      if (hasSelectedTags) {
        let summaryHTML = '<h4 style="margin: 0 0 10px 0; color: var(--primary-color)">Selected Dietary Preferences</h4>';
        
        Object.entries(selectedTags).forEach(([category, tags]) => {
          if (tags.length > 0) {
            summaryHTML += `
              <div style="margin-bottom: 8px">
                <strong>${category.charAt(0).toUpperCase() + category.slice(1)}:</strong> 
                ${tags.map(tag => `<span style="
                  display: inline-block;
                  background: var(--hover-color);
                  padding: 2px 8px;
                  border-radius: 12px;
                  margin: 2px;
                  font-size: 0.9em;
                ">${tag.replace(/-/g, ' ')}</span>`).join('')}
              </div>
            `;
          }
        });
        
        summaryDiv.innerHTML = summaryHTML;
        summaryDiv.style.display = 'block';
      } else {
        summaryDiv.style.display = 'none';
      }
    }

    // Add event listeners for dietary tag checkboxes
    Object.values(dietaryTags).flat().forEach(tag => {
      const checkbox = document.getElementById(tag);
      if (checkbox) {
        checkbox.addEventListener('change', filterDiets);
      }
    });

    // Initialize food items with USDA data
    const additionalFoodItems = {
      proteins: [
        // Existing protein items plus new ones
        { name: "Chicken Breast", category: "protein", calories: 165, protein: 31, carbs: 0, fats: 3.6, nutrients: ["high protein", "low carb"], serving: "100g" },
        { name: "Salmon", category: "protein", calories: 208, protein: 25, carbs: 0, fats: 13, nutrients: ["omega 3", "high protein"], serving: "100g" },
        { name: "Tuna", category: "protein", calories: 130, protein: 29, carbs: 0, fats: 1.3, nutrients: ["high protein", "low fat"], serving: "100g" },
        { name: "Greek Yogurt", category: "protein", calories: 59, protein: 10, carbs: 3.6, fats: 0.4, nutrients: ["probiotic", "calcium rich"], serving: "100g" },
        { name: "Egg", category: "protein", calories: 155, protein: 13, carbs: 1.1, fats: 11, nutrients: ["high protein"], serving: "100g" },
        { name: "Turkey Breast", category: "protein", calories: 104, protein: 24, carbs: 0, fats: 1, nutrients: ["high protein", "low fat"], serving: "100g" },
        { name: "Tofu", category: "protein", calories: 76, protein: 8, carbs: 1.9, fats: 4.8, nutrients: ["vegan", "calcium rich"], serving: "100g" },
        { name: "Whey Protein Isolate", category: "protein", calories: 113, protein: 27, carbs: 1, fats: 0.2, nutrients: ["high protein", "fast absorbing"], serving: "30g" },
        { name: "Tempeh", category: "protein", calories: 192, protein: 20.3, carbs: 7.6, fats: 10.8, nutrients: ["vegan", "fermented", "probiotic"], serving: "100g" },
        { name: "Cottage Cheese", category: "protein", calories: 98, protein: 11, carbs: 3.4, fats: 4.3, nutrients: ["high protein", "calcium rich"], serving: "100g" },
        { name: "Quinoa", category: "protein", calories: 120, protein: 4.4, carbs: 21.3, fats: 1.9, nutrients: ["complete protein", "gluten free"], serving: "100g" },
        { name: "Black Beans", category: "protein", calories: 132, protein: 8.9, carbs: 23.7, fats: 0.5, nutrients: ["plant protein", "high fiber"], serving: "100g" },
        { name: "Pea Protein Powder", category: "protein", calories: 391, protein: 80, carbs: 7, fats: 3.8, nutrients: ["vegan", "hypoallergenic"], serving: "100g" },
        { name: "Cod Fish", category: "protein", calories: 82, protein: 18, carbs: 0, fats: 0.7, nutrients: ["lean protein", "low fat"], serving: "100g" },
        { name: "Shrimp", category: "protein", calories: 85, protein: 20, carbs: 0, fats: 1.1, nutrients: ["lean protein", "low calorie"], serving: "100g" },
        { name: "Edamame", category: "protein", calories: 121, protein: 11.9, carbs: 8.9, fats: 5.2, nutrients: ["plant protein", "high fiber"], serving: "100g" },
        { name: "Hemp Seeds", category: "protein", calories: 553, protein: 31.6, carbs: 8.7, fats: 48.8, nutrients: ["complete protein", "omega 3"], serving: "100g" },
        { name: "Seitan", category: "protein", calories: 370, protein: 75, carbs: 14, fats: 2, nutrients: ["vegan", "high protein"], serving: "100g" },
        { name: "Tilapia", category: "protein", calories: 96, protein: 20.1, carbs: 0, fats: 1.7, nutrients: ["lean protein", "low fat"], serving: "100g" },
        { name: "Lean Pork", category: "protein", calories: 143, protein: 26, carbs: 0, fats: 3.5, nutrients: ["high protein", "vitamin B"], serving: "100g" }
      ],
      carbs: [
        // Existing carb items plus new ones
        { name: "Teff", category: "carbs", calories: 367, protein: 13.3, carbs: 73.1, fats: 2.4, nutrients: ["gluten free", "iron rich"], serving: "100g" },
        { name: "Farro", category: "carbs", calories: 340, protein: 14, carbs: 71, fats: 2.5, nutrients: ["high fiber", "high protein"], serving: "100g" },
        { name: "Spelt", category: "carbs", calories: 338, protein: 14.6, carbs: 70, fats: 2.4, nutrients: ["high fiber", "high protein"], serving: "100g" },
        { name: "Kamut", category: "carbs", calories: 337, protein: 14.7, carbs: 70.4, fats: 2.2, nutrients: ["high fiber", "high protein"], serving: "100g" },
        { name: "Rice Noodles", category: "carbs", calories: 364, protein: 6, carbs: 80, fats: 0.6, nutrients: ["gluten free", "low fat"], serving: "100g" },
        { name: "Cassava", category: "carbs", calories: 159, protein: 1.4, carbs: 38, fats: 0.3, nutrients: ["gluten free", "low fat"], serving: "100g" }
      ],
      fats: [
        // Existing fat items plus new ones
        { name: "Brazil Nuts", category: "fats", calories: 656, protein: 14.3, carbs: 12, fats: 66.4, nutrients: ["selenium rich", "heart healthy"], serving: "100g" },
        { name: "Hemp Seeds", category: "fats", calories: 553, protein: 31.6, carbs: 8.7, fats: 48.8, nutrients: ["omega 3", "high protein"], serving: "100g" },
        { name: "Pine Nuts", category: "fats", calories: 673, protein: 13.7, carbs: 13.1, fats: 68.4, nutrients: ["heart healthy", "vitamin E"], serving: "100g" },
        { name: "Hazelnuts", category: "fats", calories: 628, protein: 15, carbs: 17, fats: 61, nutrients: ["heart healthy", "vitamin E"], serving: "100g" }
      ],
      vegetables: [
        // Existing vegetable items plus new ones
        { name: "Watercress", category: "vegetables", calories: 11, protein: 2.3, carbs: 1.3, fats: 0.1, nutrients: ["vitamin K", "vitamin C"], serving: "100g" },
        { name: "Swiss Chard", category: "vegetables", calories: 19, protein: 1.8, carbs: 3.7, fats: 0.2, nutrients: ["vitamin K", "vitamin A"], serving: "100g" },
        { name: "Collard Greens", category: "vegetables", calories: 32, protein: 3, carbs: 5.7, fats: 0.6, nutrients: ["vitamin K", "calcium"], serving: "100g" },
        { name: "Dandelion Greens", category: "vegetables", calories: 45, protein: 2.7, carbs: 9.2, fats: 0.7, nutrients: ["vitamin K", "vitamin A"], serving: "100g" }
      ],
      fruits: [
        // Existing fruit items plus new ones
        { name: "Dragon Fruit", category: "fruits", calories: 60, protein: 1.2, carbs: 13, fats: 0.4, nutrients: ["vitamin C", "iron"], serving: "100g" },
        { name: "Passion Fruit", category: "fruits", calories: 97, protein: 2.2, carbs: 23.4, fats: 0.7, nutrients: ["vitamin C", "fiber"], serving: "100g" },
        { name: "Guava", category: "fruits", calories: 68, protein: 2.6, carbs: 14.3, fats: 0.9, nutrients: ["vitamin C", "fiber"], serving: "100g" },
        { name: "Papaya", category: "fruits", calories: 43, protein: 0.5, carbs: 10.8, fats: 0.3, nutrients: ["vitamin C", "vitamin A"], serving: "100g" }
      ],
      exotic_fruits: [
        { name: "Durian", category: "exotic_fruits", calories: 147, protein: 1.5, carbs: 27.1, fats: 5.3, nutrients: ["vitamin C", "thiamin"], serving: "100g" },
        { name: "Jackfruit", category: "exotic_fruits", calories: 95, protein: 1.7, carbs: 23.2, fats: 0.6, nutrients: ["vitamin C", "potassium"], serving: "100g" },
        { name: "Rambutan", category: "exotic_fruits", calories: 82, protein: 0.6, carbs: 20.9, fats: 0.2, nutrients: ["vitamin C", "iron"], serving: "100g" },
        { name: "Mangosteen", category: "exotic_fruits", calories: 63, protein: 0.5, carbs: 15.6, fats: 0.6, nutrients: ["vitamin C", "fiber"], serving: "100g" }
      ],
      specialty_oils: [
        { name: "MCT Oil", category: "specialty_oils", calories: 900, protein: 0, carbs: 0, fats: 100, nutrients: ["mct", "keto friendly"], serving: "100g" },
        { name: "Fish Oil", category: "specialty_oils", calories: 902, protein: 0, carbs: 0, fats: 100, nutrients: ["omega 3", "dha"], serving: "100g" },
        { name: "Grapeseed Oil", category: "specialty_oils", calories: 884, protein: 0, carbs: 0, fats: 100, nutrients: ["high smoke point", "vitamin E"], serving: "100g" },
        { name: "Walnut Oil", category: "specialty_oils", calories: 884, protein: 0, carbs: 0, fats: 100, nutrients: ["omega 3", "antioxidant rich"], serving: "100g" }
      ],
      nut_butters: [
        { name: "Almond Butter", category: "nut_butters", calories: 614, protein: 21, carbs: 19, fats: 53, nutrients: ["protein rich", "vitamin E"], serving: "100g" },
        { name: "Sunflower Butter", category: "nut_butters", calories: 587, protein: 17, carbs: 20, fats: 49, nutrients: ["allergy friendly", "vitamin E"], serving: "100g" },
        { name: "Cashew Butter", category: "nut_butters", calories: 587, protein: 15, carbs: 27, fats: 46, nutrients: ["heart healthy", "magnesium"], serving: "100g" },
        { name: "Tahini", category: "nut_butters", calories: 595, protein: 17, carbs: 21, fats: 53, nutrients: ["calcium rich", "iron rich"], serving: "100g" }
      ]
    };

    // Function to initialize or update food items in local storage
    function initializeFoodItems() {
      // Get existing food items from local storage
      let existingItems = JSON.parse(localStorage.getItem('foodItems') || '{}');
      
      // Merge existing items with additional items
      Object.keys(additionalFoodItems).forEach(category => {
        if (!existingItems[category]) {
          existingItems[category] = [];
        }
        
        // Add new items only if they don't already exist
        additionalFoodItems[category].forEach(newItem => {
          if (!existingItems[category].some(item => item.name === newItem.name)) {
            existingItems[category].push(newItem);
          }
        });
      });
      
      // Save back to local storage
      localStorage.setItem('foodItems', JSON.stringify(existingItems));
      return existingItems;
    }

    // Call the initialization function when the page loads
    document.addEventListener('DOMContentLoaded', () => {
      const foodItems = initializeFoodItems();
      searchFoods(); // Add this line to show foods immediately
      
      // Add event listeners for search and category change
      document.getElementById('food-search').addEventListener('input', searchFoods);
      document.getElementById('food-category').addEventListener('change', searchFoods);
    });
  </script>
</body>
</html>